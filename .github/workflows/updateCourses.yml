name: UpdateCourse

on:
  schedule:
    - cron: '0 19 * * 5'  # Viernes a las 19:00 UTC (15:00 CLT)
  workflow_dispatch:
  
jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
        - name: Clonar repositorio
          uses: actions/checkout@v4
  
        - name: Instalar Firefox y geckodriver
          run: |
            sudo apt-get update
            sudo apt-get install -y firefox
            url=$(curl -s https://api.github.com/repos/mozilla/geckodriver/releases/latest \
              | grep "browser_download_url" \
              | grep "linux64.tar.gz" \
              | cut -d '"' -f 4 \
              | head -n 1)
            
            if [ -z "$url" ]; then
              echo "‚ùå Error: No se encontr√≥ la URL de geckodriver."
              exit 1
            fi
            
            echo "üîó Geckodriver URL: $url"
            
            wget "$url"
            tar -xvzf geckodriver-*.tar.gz
            chmod +x geckodriver
            sudo mv geckodriver /usr/local/bin/
    
            rm geckodriver-*.tar.gz


  
        - name: Configurar Python
          uses: actions/setup-python@v5
          with:
            python-version: '3.12'
  
        - name: Instalar dependencias
          working-directory: scraping_alltd
          run: pip install -r requirements.txt
        
        - name: Ejecutar scraper
          working-directory: scraping_alltd
          run: python main_actions.py
          
        - name: Commit and Push Changes
          uses: stefanzweifel/git-auto-commit-action@v6
          with:
            commit_message: Actualizando json de courses
            commit_user_name: Mts [Github Actions]
       




    
